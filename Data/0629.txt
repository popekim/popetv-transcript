안녕하세요, 포프입니다.

오늘은 썰을 하나 풀어 볼게요. 예전에 제가 사용을 하려고 했던 어떤 은행 결제 관련 API 버그 잡아준 썰. 이건 듣다 보면 '좀 이상하네?'라는 생각이 들 정도로 그런 내용들이 좀 있어요.

어떤 상황이었냐 하면 제가 도와주고 있던 회사에 금융 관련 API 서비스를 연동해 줘야 했어요. 근데 이 회사가 쉽게 큰 은행이나 이런 거에 API를 연동할 수 있는 정도의 규모는 아니었고, 실리콘밸리의 어떤 금융 거래 관련 스타트업, 그쪽 하고는 연결이 돼서 이 일을 할 수가 있었어요. 그쪽이 그렇게 어마무시하게 좋은 규모는 아닌 거 같은데, 여전히 CEO가 코딩 되게 열심히 하고 있고, 이런 정도의 규모, 그리고 고객 수가 은근히 많다고 광고는 해요. 실제 계약을 맺고 뭐 하고 연동을 하기 시작을 했어요. 솔직히 금융 거래 뒤에 돈 움직이는 게 힘든 거지, API를 연동하는 일은 힘든 일은 사실 아니거든요? 그래서 저희가 이제 API 연동을 다 하고 모든 시스템이 동작을 제대로 하는 걸 확인했어요. 

근데 갑자기 그쪽에서 그런 얘기를 해요. '이제 우리가 새로운 API 버전으로 가야 한다.' 그래서 오케이 알았다 하고 신규 API를 우리가 도입하기로 했어요. 왜냐하면 기존 API 끊어버린대요. 뭐 얘기를 들어보니 기존 API는 너무 속도가 느리고 확장성에 문제가 있어서 마이크로 서비스 아키텍처로 가든 뭐 하든 가려고 했던 것 같아요. 그래서 '언제 언제 오픈되냐?', '언제 언제 오픈된다', '그러면 그때까지 준비해 놓겠다.' 그리고 우리가 다 연동을 하고 테스트 서버도 샌드박스에서 했는데 뭔가 갑자기 잘 되던 게 안 돼요. 우리는 뭔가를 요청을 넣어 놓고 했는데 이게 무슨 만료된 거래라는 내용이 계속 나오는 거예요. 그래서 '이게 왜 만료 됐지?' 그러면서 제가 리스폰스 이런 거를 보기 시작을 했어요. 근데 거기에 모든 건 크게 문제가 없어 보이는데 유닉스 타임스탬프 알죠? 그 에포크 타임이 들어가 있는 거예요. 근데 우리가 눈으로 봤을 때 이게 검증이 안 되거든요? 그래서 실제 그걸 가져와서 어딘가에 에포크 타임 변환하는 웹사이트 있을 거 아니에요? 복붙을 하고 딱 변환을 해봤더니 어? 우리가 있는 시간보다 3시간이 빠른 거예요. 근데 우리는 그 당시에 PST, 실리콘밸리 쪽이니까 미국 서부 시간에 있었고, 우리 시간으로 찍히는 것도 말이 안 되고 그죠? 우리는 언제나 UTC 타임을 찍어서 보내거든요? GMT 타임. 근데 그 시간은 우리보다 8시간이 느려요. 그래서 8시간 차이가 나야 하는데 말도 안 되게 이게 3시간 차이가 나는 거예요. 그럼 3시간 차이가 난다면 우리 서부가 아니라 동부 시간이거든요? 근데 꽤 많은 금융 쪽 인프라 애들은 동부 쪽에 있어요. 그쪽에서 많이 서비스를 운영해요. 그래서 몇 번 테스트를 해보니까 언제나 동부 시간이 찍혀오는 거예요. 그래서 우리가 고객사고 그쪽과 연결이 되는 통로가 있을 거 아니에요? 거기다가 제가 버그를 보고했어요. '야! 너네 이거 기존 API는 에포크 타임 돌아올 때 GMT 시간으로 들어와야 그게 올바른 건데, 지금 시간은 EST로 들어오고 있다. 이거 너네 버그다. 이거 고쳐야 한다.'라고 알려줬어요. 알려줬더니 그때 슬랙방 통해서 얘기했던 것 같아요. 어떤 애가 들어오더니 '뭐가 문제냐?'고 물어보는 거예요. 그래서 '이게 문제다.' 그러니 잘 이해를 못하는 것 같아요. '그러면 이런 이런 방법에 따라서 트러블 슈팅을 해볼래?'라고 물어보는 거예요. 그래서 내가 '아니. 이건 내가 지금 말했듯이 너네 기존 API에 있던 그 동작 자체가 깨먹는 거고 시간 자체가 너네 서버가 지금 있는데 시간이 들어가고 있다고. 이거 너네 버그라고. 이거 고쳐야 하는 거라고.' 또 막 이상한 소리를 막 해요. '내가 볼 때는 네가 지금 이해를 못 하고 있는 것 같으니까, 너보다는 좀 매니저하고 연결을 해줘라. 그럼 그쪽은 이해를 할 거다.' 그래서 Escalate가 됐어요. 근데 그 매니저가 CEO인 거예요. 한마디로 CEO 밑에 약간 Co-op 같은 애들 몇 명 두고 운영하고 있던 것 같아요. 들어오더니 약간 좀 짜증 내는 말투로 '이게 뭐냐?'라는 식으로 약간 짜증을 내는 거예요. 설명을 다시 해줬어요. '이거 이거다.' 자기는 딱 무슨 문제인지 알죠. 그래서 '아, 오케이' 그러면서 자기가 '알았다' 그러고 가버리고 두세 시간 뒤에 고쳤다고 알려주더라고요. 근데 나는 미안하단 말을 들은 적도 없고 '미안해, 우리가 고칠게.' 이것도 아니에요. 내가 거의 공짜로 그냥 베타 테스팅해 준 거잖아요? 근데 그런 얘기 한마디도 없고 처음에 짜증 내고 들어왔다가 '고쳤어. 됐지?' 이러고 가버렸고, 그 중간에 있던 처음 주니어 들어왔던 그 직원, 그 직원도 뭐 특별한 얘기 없었고 거기가 되게 분위기가 이상했어요.

어쨌든 간에 잡아줬어요. 근데 결과적으로는 그쪽이 나중에 실제 라이브 들어갈 때쯤 되니까 계약서에도 없는 말도 안 되는 내용을 대면서 갑자기 '돈을 10배로 더 받겠다.' 이런 식으로 얘기를 하는 거예요. 그래서 그냥 짜증 나서 저희는 안 하고 나온 케이스인데, 여기서 제가 하고 싶은 말은 몇 가지 조언이 있지만 이렇게 글로벌하게 서비스해야 하거나 시간대를 다르게 서비스해야 하는 곳에서는 이런 지역 따라 달라질 수 있는 시간 내역에 민감해야 해요. 그거를 모르고 API를 만들거나 하는 사람들은 기본적으로 사고 능력이 없는 사람들이기 때문에 웬만하면 그런 회사하고는 거래 안 하는 게 좋고요.

두 번째는 스타트업이 API를 연동해서 사용할 때 제가 POCU 아카데미 사용하면서도 그런 일이 있었지만, 스타트업들은 처음에 규모가 크지 않잖아요? 그런 데다가 갑질하는 기업이 굉장히 많아요. 한국만 무슨 갑을병정이 있는 줄 알죠? 실리콘밸리에서 API 팔아먹고 미들웨어 팔아먹는 애들은 더 심해요. 왜냐하면 그쪽에서 거래가 파기가 됐을 때 소송을 들어갈 수 있잖아요? 근데 그쪽에는 변호사 비용이 어마무시하게 높아요. 그 변호사를 채용하는 비용이 실제 계약이 파기돼서 내가 손해 보는 것보다 훨씬 많아요. 그래서 그냥 보통 소송도 안 하고 작은 애들 눌리면서 사는 거고 대기업끼리 붙으면 '너 엿 돼봐라.' 이러고 그냥 서로 소송 걸고 그냥 망신주기를 하는 거죠. 그래서 그런 스타트업이 잘하는 건 '그럼 됐다 이놈아! 더럽다!' 이러고 지네가 몸짓 키운 다음에 나중에 나와서 '쟤네 쓰지마'라고 소문 퍼트리고 다니는 것밖에 사실은 없어요.

그래서 그것도 있고 시간을 에포크 타임으로 쓰는 서비스들이 굉장히 많기는 해요. API 단에서 굉장히 많아요. 근데 개인적으로는 되게 맘에 안 들어요. 이게 특히 JSON으로 사용하면서 읽기 좋은 포맷이어야 디버깅 좋다면서 JSON으로 열심히 데이터 쏴줘요. 그 비효율적인 JSON 데이터로. 그걸 쏴주면서 조금 더 비효율을 높여서 시간 같은 버그 잘 잡게 해주라고요. 그러면 이미 시간 어느 시간대냐까지 포함한 포맷은 ISO 국제표준 포맷이 있거든요? 그거 쏴주면 JSON 날라오면 보면서 나도 한방에 뭐가 문제인지 알고, 그거를 보고 했을 때 그 들은 그 주니어 개발자도 한방에 무슨 문제인지 알 거예요. 근데 내 생각에는 그 주니어 개발자가 에포크 타임이 뭔지조차 잘 몰랐을 것 같고, 이 사람이 시차를 몰랐을 것 같진 않아요. 왜냐하면 이분은 굉장히 강한 억양이 있는 인도 쪽 개발자였거든요? 자기 오피스는 실리콘밸리에 있다고 했나? 동부에 있다고 했나? 그렇게 얘기했고 우리 시차였고 다만 그쪽에서 넘어왔던 개발자이기 때문에 시차가 어떻게 되는지 분명히 알 거예요. 그래서 그 문제는 아니었다고 생각해요. 이 회사 CEO도 인도계였거든요? 그래서 시차 문제는 아마 저는 알 거라고 생각해요. 근데 제가 맨날 하는 얘기 있죠. '서비스에서 데이트 타임이 될 때는 DateTime.UtcNow치세요. DateTime.Now 치지 마세요. DateTime.Now치면 곧바로 Linter로 다 잡아서 막 오류가 나게 하세요.' 이런 얘기 제가 하잖아요? 자기가 서비스를 만드는 순간 그런 정도의 꼼꼼함이 없었던 거겠죠. 근데 어쨌든 간에 처음 버그 발견한 것부터 버그 고치고 대응하는 자세 그리고 자기가 만든 코드의 문제가 있었을 때 그걸 솔직히 인정 못 하고 고맙다는 얘기 한마디도 못 하는 자세와 이런 걸 봤을 때 마지막까지 그 꼴까지 간 거 보면 뭐 그러려니 하고 있었고, 그 이후에 이 회사가 또 한 번 크게 문제가 된 적이 있어요. 저희 것과 상관없이 뉴스에 대박으로 난 적도 있어요. 그래서 났을 때 '뭐 그럴 수밖에 없는 회사였지. 뭐 그동안 잘 살았네.'라고 생각하고 넘어갔었죠. 어쨌든 간에 이런 열불 터지는 그 사람에 대한 불만보다는 이제 거기서 얻어갈 수 있는 교훈 쪽으로 잘 골라서 한번 잘 새겨 보시면 개발할 때 도움 꽤 될 내용들이 있을 겁니다.

포프였습니다.