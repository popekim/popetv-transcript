예, 안녕하세요. 포프입니다.

그동안 프로그래밍 얘기를 좀 안 한 것 같으니까 프로그래밍 얘기를 해 보려고 해요. 예전에 제가 스페이스 마린(Space Marine) 만들 때였던 것 같아요. 그때 한참 메모리 스톰핑(Memory stomping) 문제도 있었고요.

메모리 스톰핑이 뭐냐면, 메모리가 있는데 다른 엉뚱한 곳에서 이 메모리를 덮어쓴다거나 해서 문제가 생기는 거예요. 메모리 오버플로우(Memory overflow)라고도 할 수 있고, 메모리 코럽션(Memory corruption, 메모리 손상)이라고도 하죠. 원래 들어가지 말아야 될 메모리 주소에 무언가 내용이 들어간 거죠.

그런 걸 디버깅(Debugging)하다가 든 생각이 있었어요. 보통은 거기에 브레이크 포인트(Breakpoint)를 걸거나 조건을 달아서 디텍트(Detect)하잖아요. 메모리 코럽션이 있다고 알면 "어, 이 메모리에 문제 있는 게 써졌구나"라는 걸 알아요. 그런데 과연 이 값이 어디서 왔느냐? 이걸 알아내는 게 정말 힘들어요. 왜냐하면 보통은 메모리가 잘못 써진 뒤, 나중에 그 메모리를 읽어서 뭔가를 하려고 할 때 문제가 발생하기 때문이죠.

저는 콘솔 개발자니까 콘솔 개발킷(Dev Kit)을 사용했는데요. 예를 들어 Xbox 360 Dev Kit은 Xbox 360과 비슷하지만 디버깅 기능을 추가한 하드웨어예요. 랜선이나 USB 케이블로 연결해서 디버깅을 하죠. 그때 이런 생각을 했어요. 콘솔이라면 혹시 이걸 해결할 방법이 있지 않을까?

제가 원했던 기능은 메모리가 바뀔 때마다 그걸 전부 기록(Record)해 주는 기계예요. 예를 들어 "여기 메모리 100바이트가 할당됐다", "여기에 값이 이렇게 써졌다" 같은 걸 다 기록하는 거죠. 아니면 정말 단순하게 매 프레임(Frame)마다 메모리 스냅샷(Snapshot)을 떠서, 나중에 문제가 생겼을 때 히스토리(History)를 보면서 "어떤 메모리에 뭐가 언제 쓰였는가"를 추적할 수 있는 기능이요.

물론 그런 기능은 없었죠. 저희는 대신 메모리 알로케이션(Allocation)과 디알로케이션(Deallocation, 메모리 할당 해제)은 자체 프로그램으로 추적했어요. 할당될 때마다 이벤트를 TCP/IP로 보내서 기록하는 메모리 트래커(Tracker)는 있었죠. 웬만한 게임 회사에는 다 있을 거예요. 하지만 실제 메모리 내용이 어떻게 쓰였는지는 알 수 없었어요. "10프레임 전에 스냅샷은 어땠다" 이런 걸 녹화하는 기능은 본 적이 없었습니다.

그 당시 영국에 있던 프로그래머 "놀"이라는 친구랑도 그런 얘기를 했었어요. 그 친구도 "그런 거 있었으면 정말 좋겠다"라고 했죠. 2010년, 2011년쯤이었는데, 차세대 콘솔이 나오면 혹시 그런 기능이 들어가지 않을까 은근히 기대했어요. 자동으로 지난 120프레임 동안 메모리 히스토리를 찍어두고, 어디에 뭐가 쓰였는지 추적할 수 있게 해 주는 기능 말이죠. 아니면 아예 독립적인 하드웨어 애드온(Add-on)으로라도 나오지 않을까 싶었는데, 불행히도 그런 건 없었습니다.

그래서 여전히 메모리 스톰핑이나 메모리 코럽션을 디버깅하는 건 굉장히 힘들어요. 코드 하나하나 훑으면서 로직을 확인하거나, 아니면 운 좋게 특정 값이 눈에 띄어 "아, 이건 여기서 온 값이다"라고 추측할 수밖에 없죠. 특히 요즘처럼 멀티스레딩 환경에서는 여러 스레드가 한 메모리에 접근하니까, 버그를 리프로(reproduce, 재현)하기도 너무 어렵습니다.

그런데 최근에 인터넷을 뒤지다 보니까 "타임머신 디버깅(Time Machine Debugging)"이라는 개념이 있더라고요. 문제가 발생했을 때 과거로 돌아가서 "누가 언제 이 메모리를 썼는지" 추적할 수 있는 기능이 있는 디버거(Debugger)예요. 다만 PC용은 아니고 임베디드(Embedded) 쪽에서 봤어요. 임베디드 기기는 메모리가 워낙 작으니까 매번 덤프해도 큰 문제가 안 되거든요.

내부적으로 메모리를 전부 덤프하는 건지, 아니면 델타(Delta)만 기록하는 건지 원리는 모르겠지만, 어쨌든 이미 임베디드 쪽에 그런 기능이 있다는 걸 보고 "아, 저게 바로 내가 원했던 거구나" 싶었습니다. 그렇다면 PC 기반에서도 델타 기록이나 특정 메모리 구역만 선택적으로 기록하는 방법으로 구현할 수 있지 않을까 싶어요. 큰 디버거 회사들도 아마 같은 문제를 보고 있을 거고요.

아마 저와 똑같은 생각을 하신 분들도 많을 거예요. "이거 너무 디버깅하기 어렵다", "이런 기능 있었으면 좋겠다"라는 불만이라도 꾸준히 목소리를 내야, 컴파일러나 디버거 회사에서 이런 기능을 진지하게 검토하지 않을까 싶습니다.

메모리 스톰핑은 자주 일어나는 문제는 아니지만, 한 번 터지면 고치는데 시간이 정말 오래 걸리니까, 이런 기능이 있다면 굉장히 값어치가 크다고 생각해요.

혹시 저랑 비슷한 생각을 하셨거나, 반대 의견이 있으신 분들은 댓글로 남겨 주세요. 다들 어떻게 생각하시는지 궁금합니다.

오늘 하고 싶었던 얘기는 "그런 디버깅 기능이 있었으면 좋겠다"라는 거였고요. 별로 유용한 정보였는지는 모르겠지만, 한 번쯤 생각해 보시면 괜찮을 것 같아서 만들었습니다.

그러면 이 정도로 끝내죠. 포프였습니다.
